# Adlayer Thirdy Party Stack

## What is Adlayer
Adlayer is the best platform to manage delivery and measure the result of online advertising.

## How ads are loaded on the web ?

### How other guys do:
Most ad servers are placed like this:

```html
<script>
	OAS_AD('x07');
</script>
```

This is bad:

1. We are hurting the concept by web standards guys "in layers development".

[<img src="http://d.alistapart.com/understandingprogressiveenhancement/m-m.jpg" />](http://alistapart.com/article/understandingprogressiveenhancement)

2. This is a inline script ([Dom monster](http://mir.aculo.us/dom-monster/) says that it makes parsing slow)

<img scr="https://raw.github.com/adlayer/display-tech/master/benchmarks/imgs/dom_monster_inline_javascript_tip.png" />

3. The biggest problem is that what this function is doing actually is:

```
document.write('<a href="'+OAS_url	+"click_nx.ads/"+OAS_sitepage+"/1"+OAS_rns+"@"+OAS_listpos+"!"+pos+"?"+OAS_query+'" target="'+OAS_target+'">');
document.write('<img src="'+OAS_url+"adstream_nx.ads/"+OAS_sitepage+"/1"+OAS_rns+"@"+OAS_listpos+"!"+pos+"?"+OAS_query+'" border="0"></a>');
```

Here's what [Jshint](http://www.jslint.com) says about ```document.write```:

<img src="https://raw.github.com/adlayer/display-tech/master/benchmarks/imgs/jshint_document_write_error.png" />

And here is what Douglas Crockford says about ```eval```:
<img src="https://raw.github.com/adlayer/display-tech/master/benchmarks/imgs/eval_is_evil.png" />

Some people are doing it even worse:

```html
OAS_rn=new String(Math.random());
OAS_rns=OAS_rn.substring(2,11);
document.write("<scr"+"ipt type='text/javascript' src='http://ads.example.com/Adserver/ads/adstream_jx.ads/example.com/example.com/home/1" + OAS_rns +"@Top1'><\/script>");
```

Which will obviously write:

```html
<script type="text/javascript" src="http://ads.example.com/Adserver/ads/adstream_jx.ads/example.com/example.com/home/1189969050@Top1"></script>
```

The last part will load another script synchronous (blocking content).

### How we do:

```html
<head>
	<script async=true src="space"></script>
</head>

<body>
	<div class="adlayer_space" id="jdcsdc9d9csdc"></div>
</body>
```
Using the async method to load the script don't force us to put it in the end of body. We like it at head and downloads in background.

Basically what the space.js does is:

1. Load the content using JSONP
2. Render each space when the DOM is ready

The first part is really important because she don't have to wait for "domReady" to start make our asynchronous request (fast).

## How ads are displayed ?

### How they do:
[See the code](benchmarks/rendered/adsense.html) generated by a popular [Google Adsense](benchmarks/rendered/adsense.html)

### How we do:
[See the code](benchmarks/rendered/adlayer.html) generated by a popular [Adlayer Pages Widget](rendered/adlayer.html)

## Iframeless
Iframes isolates the content from thirdy-party, which is a good thing when you don't trust the content being loaded.
With Adlyer all content placed in your page are inserted by you, so you should not be worried about this.

Iframes are also hard to customize, our tech was built for hackability for extensibility, Iframes don't.

Actually exists a way to interact to iframe content using HTML5 postMessage. But obviously it will not work on old browsers and looks stupid for some interaction.

## How data is tracked ?
We have the same origin police problem again:

So the options are: 
* JSONPI (JSON + Padding + Iframe)
* Pixel tracking

Why we choose pixel tracking ?
JSONPI aka iframe POST allows you to get the response of server in the iframe content. 

But for us, the response does not matter, the user are not interested about if they have been tracked or not.


## Why to open source ?

## References
http://blog.adlayer.org/post/45140005964/blocos-asyncronous-vs-codigo-elegante

http://velocityconf.com/velocity2010/public/schedule/detail/15412

http://blog.socialcast.com/third-party-javascript/

http://www.olark.com/spw/2011/10/lightningjs-safe-fast-and-asynchronous-third-party-javascript/

https://www.webkit.org/blog/1395/running-scripts-in-webkit/

http://www.slideshare.net/SlexAxton/breaking-the-cross-domain-barrier